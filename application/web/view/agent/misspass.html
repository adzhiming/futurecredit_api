<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
        <link rel="shortcut icon" href="__ASSETS__/agent/img//favicon.ico" type="image/x-icon">
        <title>聚合共享</title>
    </head>
<script type="text/javascript">
    var deviceWidth = document.documentElement.clientWidth;
    if (deviceWidth > 750) deviceWidth = 750;
    document.documentElement.style.fontSize = deviceWidth / 7.5 + 'px';
</script>
<link rel="stylesheet" type="text/css" href="__ASSETS__/agent/css/common.css" />
<link rel="stylesheet" type="text/css" href="__ASSETS__/agent/css/other.css" />
<style type="text/css">
    html,body{
        width:100%;height:100%;background:url('__ASSETS__agent/img/sq_bg.jpg')no-repeat;
        overflow:hidden;background-size:100% 100%;
    }
</style>
<body>
<div class="header-logo">
    <img src="__ASSETS__agent/img/sq-logo.png"/>
</div>
<div class="shenqin-box">

    <form action="" name="form1" id="mesg">
        <div class="row" >
            <input  type="text"  name="phone" placeholder="请输入手机号码" class="ipt1">
        </div>
        <div class="yzm-input row" style="font-size:0px;">
            <input type="text"  name="msg" placeholder="请输入验证码" class="ipt1 yzm" >
            <input type="button"  value="获取验证码" onclick="getmsg()" class="getcode">
        </div>
        <div class="row" >
            <input  type="password"  name="password" placeholder="请输入重置密码" class="ipt1">
        </div>
        <div class="tip text-center error paddingtop15" style="display:none;"></div>
        <div onclick="resetPassword()" class="registerspan">确认</div>
    </form>
    
</div>

<script type="text/javascript" src="__ASSETS__/agent/js/jquery.js"></script>
<script type="text/javascript">

    var api_url = "{$api_url}";
    

    function resetPassword(){
        var name = $('input[name="phone"]').val();
        var password = $('input[name="password"]').val();
        var msg = $('input[name="msg"]').val();

        if(name == ''){
            $('.tip').show().text('请输入手机号');
            return 
        }else if( !(/^1[34578]\d{9}$/.test(name))){
            $('.tip').show().text('手机号有误');
            return
        }else if(msg == ''){
            $('.tip').show().text('请输入验证码');
            return
        }else if(password.length < 6){
            $('.tip').show().text('密码请输入6位字符');
            return
        }else{
            $('.tip').hide().text('');
        }
        
        $.post(api_url+'agent/resetPass',{phone:name,password:password,code:msg,type:2},function(res){
        // $.post(api_url+'agent/createAgentBkl',{phone:name},function(res){
            if(res.code == 1){
                zdyAlert.init(res.msg ,function(){
                     window.location.href="/web/agent/login";
                })
            }else{
                zdyAlert.init(res.msg ,function(){})
            }
        })
    }
    function getmsg(){
        var isGet = true;
        var s = 60;
        var name = $('input[name="phone"]').val();
        if(name == ''){
            $('.tip').show().text('请输入手机号');
            return 
        }else if( !(/^1[34578]\d{9}$/.test(name)) ){
            $('.tip').show().text('手机号有误');
            return
        }
        if(isGet){
            // $.post('http://test.api.futurecredit.net/api/user/crode',{phone:name},function(res){
            $.post(api_url+'user/crode',{phone:name,type_id:4},function(res){
                console.log(res)
                if(res.code == 1){
                    isGet = false
                    $('.getcode').attr("disabled","disabled").css('background','#7c7c7c');
                    var timer = setInterval(function(){
                        s--;
                        if(s <= 0){
                            isGet = true;
                            $(".getcode").removeAttr("disabled").css('background','#4f7dfd').val('获取验证码');
                            clearInterval(timer);
                        }else{
                            $(".getcode").val(s+'秒后重新获取')
                        }
                    },1000)
                }
                zdyAlert.init(res.msg,function(){})
            })
        }
    }
    var zdyAlert = {
        init:function(e,callback){
            var html = '<div class="alertcen"></div>';
            html += '<div class="alertnei box-show"><p class="title">提示</p><div class="alert-con">'+ e +'</div><div class="alert-btn">确定</div></div>';
            $('body').append(html);
            $('.alert-btn').click(function(){
                $('.alertcen,.alertnei').remove();
                callback();
            })
        }
    }
    
</script>
</body>
</html>